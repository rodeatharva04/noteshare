{% extends 'base.html' %}

{% block content %}
<style>
    /* === Page Specific Overrides === */
    /* Ensure list items in password help text (bullet points) look clean */
    .help-text ul {
        padding-left: 20px;
        margin-bottom: 0;
        margin-top: 5px;
    }
    .help-text li {
        list-style-type: disc; 
        color: rgba(255, 255, 255, 0.6);
    }
</style>

<div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <!-- card-modern: Inherits the dark glass look from base.html -->
    <div class="card-modern" style="max-width: 500px; width: 100%;">
        
        <!-- HEADER: Red Gradient for Security Context -->
        <div class="card-header-modern" style="background: var(--grad-danger) !important;">
            <div class="mb-2">
                <i class="fas fa-shield-alt fa-3x text-white opacity-75"></i>
            </div>
            <h3 class="fw-bold mb-0 text-white">Change Password</h3>
            <p class="small text-white-50 mb-0">Secure your account with a strong password.</p>
        </div>

        <div class="card-body p-4 p-md-5">
            <form method="post" id="passwordChangeForm">
                {% csrf_token %}
                
                <!-- Non-field Errors -->
                {% if form.non_field_errors %}
                <div class="alert alert-danger py-2 small shadow-sm mb-4 border-0">
                    {% for error in form.non_field_errors %}
                    <i class="fas fa-exclamation-circle me-1"></i> {{ error }}
                    {% endfor %}
                </div>
                {% endif %}

                {% for field in form %}
                <div class="mb-4">
                    <!-- Label: Forced White -->
                    <label for="{{ field.id_for_label }}" class="small text-white text-uppercase fw-bold mb-1">
                        {{ field.label }}
                    </label>
                    
                    <div class="input-group">
                        <!-- Icon: Red Accent to match header -->
                        <span class="input-group-text" style="border-color: var(--border-color);">
                            <i class="fas fa-lock text-danger"></i>
                        </span>
                        
                        <!-- Input: Uses global form-control style -->
                        <input type="{{ field.field.widget.input_type }}" 
                               name="{{ field.name }}" 
                               id="{{ field.id_for_label }}" 
                               class="form-control"
                               placeholder="{{ field.label }}"
                               {% if field.field.required %}required{% endif %}>
                    </div>

                    <!-- Help Text: Use |safe to preserve formatting (bullet points) -->
                    {% if field.help_text %}
                        <div class="small text-white-50 mt-2 help-text" style="font-size: 0.8rem;">
                            {{ field.help_text|safe }}
                        </div>
                    {% endif %}

                    <!-- Errors -->
                    {% if field.errors %}
                        <div class="text-danger small mt-1 fw-bold">
                            {% for error in field.errors %}
                                <div><i class="fas fa-exclamation-circle me-1"></i> {{ error }}</div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                {% endfor %}

                <!-- Actions -->
                <div class="d-grid gap-3 mt-4">
                    <!-- Submit: Red Gradient -->
                    <button type="submit" id="submitBtn" class="btn-brand shadow-lg fw-bold" style="background: var(--grad-danger) !important;">
                        Update Password
                    </button>
                    
                    <!-- Cancel -->
                    <a href="{% url 'profile' %}" class="btn btn-outline-light rounded-pill fw-bold">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Simple UX Script for Button State -->
<script>
    document.getElementById('passwordChangeForm').addEventListener('submit', function() {
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-circle-notch fa-spin me-2"></i> Updating...';
    });
</script>
{% endblock %}